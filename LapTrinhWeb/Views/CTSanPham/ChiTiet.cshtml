@model tblSanPham
@{
    ViewBag.Title = "ChiTiet";
    Layout = "~/Views/Shared/_LayoutBH.cshtml";
    var petlq = (List<tblSanPham>)ViewBag.PetLQ;
    var petncc = (List<tblSanPham>)ViewBag.PetNCC;
    var hinhanhphu = (List<tblHinhAnh>)ViewBag.HinhAnhList;
    var dsbl = (List<tblBinhLuan>)ViewBag.BinhLuanList;
}

<style>
    :root {
        --primary-color: #28a745;
        --secondary-color: #ffc107;
        --text-dark: #333;
        --text-muted: #6c757d;
    }

    body {
        background-color: #f8f9fa;
    }

    /* Image Gallery */
    .product-gallery {
        background: white;
        padding: 20px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }

    .main-image-container {
        border-radius: 15px;
        overflow: hidden;
        margin-bottom: 15px;
        border: 1px solid #eee;
    }

    .main-image {
        width: 100%;
        height: 450px;
        object-fit: contain;
        transition: transform 0.5s ease;
    }

    .thumb-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 10px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s;
    }

        .thumb-img:hover, .thumb-img.active {
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }

    /* Product Info */
    .product-details {
        padding: 20px;
    }

    .info-table {
        width: 100%;
        margin-top: 20px;
    }

        .info-table tr {
            border-bottom: 1px solid #eee;
        }

        .info-table td {
            padding: 12px 0;
        }

    .label-attr {
        font-weight: 600;
        color: #777;
        width: 180px;
    }

    .value-attr {
        color: var(--text-dark);
        font-weight: 500;
    }

    .price-tag {
        font-size: 2rem;
        color: #e44d26;
        font-weight: 800;
        margin: 20px 0;
    }

    /* Actions */
    .action-btns .btn {
        padding: 12px 30px;
        border-radius: 50px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Review Section */
    .review-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        border-left: 5px solid var(--primary-color);
    }

    /* Product Grid */
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 20px;
    }

    .product-card {
        background: white;
        border-radius: 15px;
        padding: 15px;
        transition: all 0.3s;
        text-align: center;
        border: 1px solid #eee;
    }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .product-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }

    .section-title {
        border-left: 5px solid var(--primary-color);
        padding-left: 15px;
        margin-bottom: 30px;
        font-weight: 700;
    }
</style>

<div class="container py-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb bg-transparent p-0">
            <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
            <li class="breadcrumb-item active">@Model.TenSP</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Gallery -->
        <div class="col-lg-5 mb-4">
            <div class="product-gallery">
                <div class="main-image-container">
                    <img id="mainImage" src="@Url.Content("~/Content/HinhAnh/" + Model.AnhDaiDien)" class="main-image" alt="@Model.TenSP" />
                </div>
                <div class="d-flex flex-wrap gap-2 justify-content-center">
                    <img src="@Url.Content("~/Content/HinhAnh/" + Model.AnhDaiDien)"
                         class="thumb-img active"
                         onclick="changeImage(this, '@Url.Content("~/Content/HinhAnh/" + Model.AnhDaiDien)')" />

                    @if (hinhanhphu != null)
                    {
                        foreach (var img in hinhanhphu)
                        {
                            if (img.HinhAnh != Model.AnhDaiDien)
                            {
                                <img src="@Url.Content("~/Content/HinhAnh/" + img.HinhAnh)"
                                     class="thumb-img"
                                     onclick="changeImage(this, '@Url.Content("~/Content/HinhAnh/" + img.HinhAnh)')" />
                            }
                        }
                    }
                </div>
            </div>
        </div>

        <!-- Details -->
        <div class="col-lg-7">
            <div class="product-details">
                <h1 class="display-6 fw-bold text-dark">@Model.TenSP</h1>

                <div class="price-tag">
                    @string.Format("{0:#,##0} ₫", Model.GiaBan)
                </div>

                <div class="description-box bg-white p-3 rounded shadow-sm border mb-4">
                    <h5 class="fw-bold">Mô tả chi tiết:</h5>
                    <p class="text-muted mb-0">@Model.MoTa</p>
                </div>

                <table class="info-table">
                    <tr>
                        <td class="label-attr"><i class="bi bi-gender-ambiguous me-2"></i>Giới tính</td>
                        <td class="value-attr">@Model.GioiTinh</td>
                    </tr>
                    <tr>
                        <td class="label-attr"><i class="bi bi-calendar-date me-2"></i>Ngày sinh</td>
                        <td class="value-attr">@(Model.NgaySinh.HasValue ? Model.NgaySinh.Value.ToString("dd/MM/yyyy") : "Đang cập nhật")</td>
                    </tr>
                    <tr>
                        <td class="label-attr"><i class="bi bi-palette me-2"></i>Màu sắc</td>
                        <td class="value-attr">@Model.MauSac</td>
                    </tr>
                    <tr>
                        <td class="label-attr"><i class="bi bi-heart-pulse me-2"></i>Sức khỏe</td>
                        <td class="value-attr">@Model.TinhTrangSucKhoe</td>
                    </tr>
                </table>

                <div class="action-btns d-flex gap-3 mt-4">
                    <button class="btn btn-success btn-lg flex-grow-1">
                        <i class="bi bi-cart-plus me-2"></i>Thêm vào giỏ
                    </button>
                    <button class="btn btn-outline-danger btn-lg flex-grow-1">
                        Mua ngay
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews -->
    <div class="mt-5 pt-5 border-top">
        <h3 class="section-title">Đánh giá khách hàng</h3>
        <div class="row">
            <div class="col-lg-4">
                <div class="card p-4 shadow-sm border-0 rounded-4 mb-4">
                    <h5>Để lại bình luận</h5>
                    <form method="post" action="@Url.Action("GuiBinhLuan", "CTSanPham")">
                        <input type="hidden" name="MaSP" value="@Model.MaSP" />
                        <div class="mb-3">
                            <input type="text" name="HoTen" class="form-control" placeholder="Họ tên" required />
                        </div>
                        <div class="mb-3">
                            <select name="SoSao" class="form-select">
                                <option value="5">★★★★★</option>
                                <option value="4">★★★★☆</option>
                                <option value="3">★★★☆☆</option>
                                <option value="2">★★☆☆☆</option>
                                <option value="1">★☆☆☆☆</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <textarea name="NoiDung" class="form-control" rows="3" placeholder="Cảm nhận của bạn..."></textarea>
                        </div>
                        <button class="btn btn-primary w-100 rounded-pill">Gửi đánh giá</button>
                    </form>
                </div>
            </div>
            <div class="col-lg-8">
                @if (dsbl != null && dsbl.Any())
                {
                    foreach (var bl in dsbl)
                    {
                        <div class="review-card shadow-sm">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="mb-0 fw-bold">@bl.HoTen</h6>
                                <small class="text-muted">@bl.Ngay.ToString("dd/MM/yyyy")</small>
                            </div>
                            <div class="text-warning mb-2">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <i class="bi bi-star@(i <= bl.SoSao ? "-fill" : "")"></i>
                                }
                            </div>
                            <p class="mb-0">@bl.NoiDung</p>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center py-5 bg-white rounded-4 shadow-sm">
                        <i class="bi bi-chat-dots display-4 text-muted"></i>
                        <p class="mt-2">Chưa có đánh giá nào. Hãy là người đầu tiên!</p>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Related Products -->
    <div class="mt-5">
        <h3 class="section-title">Sản phẩm cùng danh mục</h3>
        <div class="product-grid">
            @foreach (var item in petlq)
            {
                <div class="product-card">
                    <a href="@Url.Action("ChiTiet","CTSanPham", new {masp = item.MaSP})" class="text-decoration-none text-dark">
                        <img src="~/Content/HinhAnh/@item.AnhDaiDien" alt="@item.TenSP" />
                        <h6 class="fw-bold mt-2">@item.TenSP</h6>
                        <p class="text-danger fw-bold">@string.Format("{0:N0} ₫", item.GiaBan)</p>
                    </a>
                    <button class="btn btn-sm btn-outline-success rounded-pill w-80">Thêm vào giỏ</button>
                </div>
            }
        </div>
    </div>
    <div class="mt-5">
        <h3 class="section-title">Sản phẩm cùng nhà cung cấp</h3>
        <div class="product-grid">
            @foreach (var item in petncc)
            {
                <div class="product-card">
                    <a href="@Url.Action("ChiTiet","CTSanPham", new {masp = item.MaSP})" class="text-decoration-none text-dark">
                        <img src="~/Content/HinhAnh/@item.AnhDaiDien" alt="@item.TenSP" />
                        <h6 class="fw-bold mt-2">@item.TenSP</h6>
                        <p class="text-danger fw-bold">@string.Format("{0:N0} ₫", item.GiaBan)</p>
                    </a>
                    <button class="btn btn-sm btn-outline-success rounded-pill w-80">Thêm vào giỏ</button>
                </div>
            }
        </div>
    </div>
</div>

<script>
    function changeImage(element, url) {
        // Change src
        const mainImg = document.getElementById("mainImage");
        mainImg.style.opacity = '0';

        setTimeout(() => {
            mainImg.src = url;
            mainImg.style.opacity = '1';
        }, 200);

        // Update active class
        document.querySelectorAll('.thumb-img').forEach(img => img.classList.remove('active'));
        element.classList.add('active');
    }
</script>